---
title: "Creating database links"

---

This topic describes how you can set up the infrastructure for linking an existing Oracle database to your cluster for reporting. This setup allows you to use and evaluate your cluster without risking your production environment.

Assume that your Oracle database is deployed on a virtual machine in the France Central region. You will need the following details of your Oracle and Postgres deployments:   

-   Cluster:
    -   Region: `Japan East`
    -   Subscription: `test`
    -   Cluster ID: `p-c4j0jfcmp3af2ieok5eg` 
    -   Account ID: `brcxzr08qr7rbei1` 
    -   Organization's domain name: `biganimal.io` 
    -   Virtual Network: `vnet-cluster`


-   Oracle client VM called `client-vm`:
    -   Port: `1555`
    -   Region: `France Central`
    -   Subscription: `development`
    -   Resource group: `rg-client`
    -   Virtual network: `vnet-client`
    -   Virtual network subnet: `snet-client`

For steps 1 and 2, log in to the the Azure portal from the subscription used to deploy and manage your Oracle database. 

## Step 1: Create a standard load balancer

In this step, you create an Azure Load Balancer in the same resource group as your Oracle database.

1. In the search box at the top of the portal, enter Load balancer. Select **Load balancers** in the search results. 

2. In the Load balancer page, select **Create**.

3. In the Basics tab of the Create load balancer page. Enter or select the following information:
    1. Use a unique **Name** for the load balancer, for example, `dblink-lb`.

    1. Select the **Subscription** (`development`) and the Resource group (`rg-client`), on which the Oracle's virtual machine is deployed.
    3. Select the **Region** where Oracle's virtual machine is deployed (`France Central`). 
    4. Select the **SKU** as `Standard`.
    5. Select the **Type** as `Internal`.

4. In the Frontend IP configuration tab, select **+Add a frontend IP configuration**. Enter or select the following information:
   1. Use a unique **Name** for the frontend IP configuration, for example, `frontend-ip-lb`.

   2. Select the same virtual network (`vnet-client`) and subnet (`snet-client`) details for deploying Oracle's virtual machine.

5. In the Backend pools tab, select **+ Add a backend pool**,  enter, or select the following information:
   1. Use a unique **Name** for the backend pool, for example, `backend-pool-lb`.

   2. Select **+Add** and add the virtual machine on which the Oracle database is deployed (`client-vm`). 

6. In the Inbound rules tab, select **Add a load balancing rule**.
   1. Select the Frontend IP address and Backend pool created previously in this procedure. 
   
   2. Enter the Oracle port as the backend port (`1555`).
   3. Under Health Probe, select **Create new** and configure the criteria for which the load balancer instance can be considered healthy and receive traffic.  
7. The load balancing rule is listed in the Inbound rules tab.

8. Select **Review + create** and **Create**.

## Step 2: Create an Azure Private Link service

In this step, you create an Azure Private Link service in the same resource group as your Oracle database.

1.  Get the resource group details from the Azure CLI or the Azure portal and note the resource group name. For example, if the database's virtual network is `vnet-client`, use the following command: 

    ```shell
    $ az network vnet list --query "[?name==\`vnet-client\`].resourceGroup" -o json

    ```

1.  On the upper-left part of the page in the Azure portal, select **Create a resource**.

1.  In the **Search the Marketplace** box, search for *Private Link*.

1.  Select **Create**.

1.  Enter the details for the Azure Private Link. Use a unique name for the Azure Private Link, for example, `db-service-private-link`. 

2.  Enter the resource group name, which is output from step 1. 

3.  In the **Outbound settings** page, select the Load balancer and Load balancer frontend IP address created above.

4.  On the **Access security** page, configure the level of access for the private link service. See [control service exposure](https://docs.microsoft.com/en-us/azure/private-link/private-link-service-overview#control-service-exposure) for details.

 !!! Note
     Suppose the required access is not provided to the account or subscription accessing the Oracle database. In that case, you must manually approve the connection request from the **Pending connections** page in **Private Link Center**.


5.  After the private link service is created, note its alias. The alias is the unique ID for your private service, which you can share with the service consumers. Obtain the alias either from the Azure portal or by using the following CLI command:

    ```shell
    $ az network private-link-service list --query "[?name=='db-service-private-link'].alias" -o tsv
    ```

6.  Select **Review + Create**.

7.  Select **Create**.

For step 3, switch to the Azure subscription used to deploy and manage your cluster.

## Step 3: Create an Azure Private Endpoint

Create an Azure Private Endpoint in your cluster's virtual network. After you create the private endpoint, you can use its private IP address to access the Oracle database.

1.  On the upper-left side of the screen in the Azure portal, select **Create a resource > Networking > Private Link**, or in the search box, enter *Private Link*.

2.  Select **Create**.

3.  In Private Link Center, select **Private endpoints** in the menu on the left.

4.  In Private endpoints, select **Add**.

5.  Enter the details for the private endpoint as shown in the following image. Use a unique name for the private endpoint. 

    For example, enter `vnet-cluster-private-endpoint`, where `vnet-cluster` is the virtual network of your cluster. 

    !!! Note
        In a later step, you need the private endpoint's name to get its private IP address.

6.  Connect the private endpoint to the private link service that you created by entering its alias.

7.  In the **Configuration** page, enter the cluster's Virtual Network *vnet-cluster*.

8.  Select **Review + Create**.

9.  Select **Create**.

 !!! Note
     If the private endpoint's status appears as **Pending**, your account or subscription might not be authorized to access the private link service. 

     To resolve this issue, the connection must be manually approved from the Pending connections page in Private Link Center of Oracle's Azure subscription.

10. Now that you have successfully built a tunnel between your Oracle database and the cluster, ensure you have the appropriate inbound and outbound port rules to enable traffic between your cluster and Oracle.

## Step 4: Create a database link

1. From the client VM *vm-client*, access the cluster by using the private IP address:
    
    ```shell
    psql -W "postgres://edbuser@172.21.0.5:5432/edbstore?sslmode=require" 
    Password: 
    psql (12.9 (Ubuntu 12.9-Bubuntu0.20.04.1). server 14.2.1 (Debian 14.2.1-14deb10)) 
    WARNING: psql major version 12, server major version 14. 
              Some psql features might not work.
    SSL connection (protocol: TL5v1.3. cipher: TLS_AE5_256_GCM_SliA364. bits: 256. compression: off) Type "help" for help. 
    ```

2. Create a database link to the cluster from your Oracle database.

    ```shell
    edbstore=# create public database link oraconnpriv connect to system identified by ******** using oci '//172.21.0.4:1521/XE';
    CREATE DATABASE LINK 
    edbstore=# select sysdate from dualBoraconn; 
               sysdate
    ____________________________________ 
    12-APR-22 B8:02:52 (1 row) 1  

    ```